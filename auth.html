<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  
  <title>Bejelentkezés - SmartMarket</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#6d28d9">
  <link rel="icon" type="image/png" href="logo.png">
  <link rel="apple-touch-icon" href="logo.png">

  <script src="https://cdn.tailwindcss.com"></script>
  <script defer src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <script defer src="./config.js"></script>
</head>
<body class="bg-slate-100 flex justify-center items-center min-h-screen">
  <div class="bg-white p-6 rounded-xl shadow w-full max-w-sm space-y-4">
    <h1 class="text-xl font-bold text-center text-violet-600">SmartMarket</h1>
    <input id="email" type="email" placeholder="Email" class="w-full border rounded p-2"/>
    <input id="password" type="password" placeholder="Jelszó" class="w-full border rounded p-2"/>
    <button id="login" class="w-full bg-violet-600 text-white rounded p-2">Bejelentkezés / Regisztráció</button>
    <p id="msg" class="text-center text-sm"></p>
  </div>
  <script>
    document.addEventListener('DOMContentLoaded', ()=>{
      const { SUPABASE_URL, SUPABASE_ANON_KEY } = window.__CONFIG__;
      const { createClient } = supabase;
      const supa = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
      document.getElementById('login').addEventListener('click', async ()=>{
        const email = document.getElementById('email').value.trim();
        const pass = document.getElementById('password').value.trim();
        const msg = document.getElementById('msg');
        if (!email || !pass) { msg.textContent = 'Töltsd ki a mezőket'; return; }
        const { error } = await supa.auth.signInWithPassword({ email, password: pass });
        if (error) {
          const { error: sErr } = await supa.auth.signUp({ email, password: pass });
          msg.textContent = sErr ? sErr.message : 'Regisztráció sikeres!';
          if (!sErr) setTimeout(()=>location.href='./index.html',1000);
        } else {
          msg.textContent = 'Sikeres belépés!';
          setTimeout(()=>location.href='./index.html',1000);
        }
      });
    });
  </script>
</body>
</html>
